<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game About Squares</title>
</head>
<body>
<script src="taptapir/taptapir.js"></script>
<script src="taptapir/taptapir_gamepad.js"></script>

<script type="text/sunsnake">
#Global Functions
ASSETS_FOLDER = 'assets/'

set_orientation('landscape')
set_background_color('black')
set_window_color('gray')
set_scale(1.0)

#VARIABLES
squares = []
directionChangers = []
endPoints = []
reset = True

#levels
level1 = "level1.js"
level2 = "level2.js"
level3 = "level3.js"
currentLevel = level1

def DirectionChanger(x=0,y=0,directionChange='Left'):
    let directionChanger = Entity(scale=.1,color=color.dark_gray,x=x,y=y,z=.1,directionChange=directionChange)
    if directionChanger.directionChange == 'Right':
        directionChanger.text = 'Right'
    elif directionChanger.directionChange == 'Left':
        directionChanger.text = 'Left'
    elif directionChanger.directionChange == 'Up':
        directionChanger.text = 'Up'
    elif directionChanger.directionChange == 'Down':
        directionChanger.text = 'Down'
    directionChangers.append(directionChanger)

def Square(blockcolor=color.blue,x=0,y=0,direction='Right', id=''):
    let square = Entity(scale=.1,color=blockcolor, x=x,y=y,direction=direction, id=id)
    if square.direction == 'Right':
        square.text = 'Right'
    elif square.direction == 'Left':
        square.text = 'Left'
    elif square.direction == 'Up':
        square.text = 'Up'
    elif square.direction == 'Down':
        square.text = 'Down'
    square.on_click = def():
        if square.direction == 'Right':
            square.x += square.scale[0]
            square.text = 'Right'
        elif square.direction == 'Left':
            square.x -= square.scale[0]
            square.text = 'Left'
        elif square.direction == 'Up':
            square.y += square.scale[1]
            square.text = 'Up'
        elif square.direction == 'Down':
            square.y -= square.scale[1]
            square.text = 'Down'
    squares.append(square)

def EndPoint(x=0,y=0,blockcolor=color.blue, id=''):
    let endPoint = Entity(scale=.075,roundness=1,x=x,y=y,z=.1,color=blockcolor, id=id)
    endPoints.append(endPoint)

def update():
    if reset:
        reset = False
        for square in squares:
            destroy(square)
        squares = []
        for changer in directionChangers:
            destroy(changer)
        directionChangers = []
        for endPoint in endPoints:
            destroy(endPoint)
        endPoints = []
        var scriptElement = document.createElement("script");
        scriptElement.src = currentLevel;
        document.body.appendChild(scriptElement);
    for square in squares:
        for square2 in squares:
            dist=distance(square.xy,square2.xy)
            if dist <= .01 and square.id != square2.id:
                reset = True
        for changer in directionChangers:
            dist=distance(changer.xy,square.xy)
            if dist <= .01:
                square.direction = changer.directionChange
                square.text = changer.directionChange
        for endpoint in endPoints:
            dist=distance(endpoint.xy,square.xy)
            if dist <= .01:
                if endpoint.id == square.id:
                    destroy(square)
                    destroy(endpoint)
                    squares.remove(square)
                    endPoints.remove(endpoint)
                elif endpoint.id != square.id:
                    reset = True


</script><script src="taptapir/sunsnake_compiler.js"></script>
</body>
</html>